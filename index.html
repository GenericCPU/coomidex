<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CoOMidex - Final Two-Column Panels</title>
  <style>
    /* RESET */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      overflow: hidden; /* We scroll in .main-content, not the body */
    }

    /* TOP BAR */
    header {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 60px;
      background-color: #000;
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
    }
    .logo {
      font-size: 20px;
      font-weight: bold;
    }

    /* SCROLLABLE MIDDLE GRID */
    .main-content {
      position: absolute;
      top: 60px;         /* below header */
      bottom: 320px;     /* above bottom dash */
      left: 0; right: 0;
      overflow-y: auto;
      padding: 20px;
      background-color: black;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      justify-items: center;
    }
    .grid-item {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 8px;
      background-color: #2f2f2f;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .grid-item:hover {
      transform: scale(1.05);
    }
    .grid-item img {
      max-width: 93px;
      max-height: 93px;
      border-radius: 4px;
    }

    /* HOLLOW OUTLINES (no fill) */
    .highlight-orange {
      border: 3px dashed orange;
      background: transparent;
      border-radius: 8px;
    }
    .highlight-blue {
      border: 3px dashed dodgerblue;
      background: transparent;
      border-radius: 8px;
    }
    .selected-orange {
      border: 3px solid orange;
      background: transparent;
      border-radius: 8px;
    }
    .selected-blue {
      border: 3px solid dodgerblue;
      background: transparent;
      border-radius: 8px;
    }

    /* BOTTOM DASH (two adjacent panels, no gap) */
    footer {
      position: fixed;
      bottom: 0; left: 0;
      width: 100%;
      height: 320px;
      background-color: #1b1b1b;
      z-index: 1000;
      display: flex;
      align-items: flex-start;
      justify-content: center; 
      gap: 0; /* no gap in the middle */
      padding: 0;
    }x

    /* CHAMPION PANELS (each ~50% width) */
    .champion-panel {
      position: relative;
      width: 50%;
      height: 100%;  /* fill entire 320px footer */
      display: flex;
      flex-direction: column;
      border-radius: 0; /* no extra background color */
    }

    /* SLEEK TOP BAR (reduced height) */
    .panel-top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0;
      height: 8px; /* Slightly taller to make the shape more visible */
      border-top-left-radius: 0px;
      border-top-right-radius: 0px;
      flex-shrink: 0;
      overflow: visible; /* Allow the shape to be visible */
      margin: 0; /* Remove margin to allow bars to touch */
    }

    /* Left panel trapezoid (angled on left side only) */
    #orangePanel .panel-top-bar {
      clip-path: polygon(0% 0%, 15% 100%, 100% 100%, 100% 0%);
    }

    /* Right panel trapezoid (angled on right side only) */
    #bluePanel .panel-top-bar {
      clip-path: polygon(0% 0%, 0% 100%, 85% 100%, 100% 0%);
    }

    .panel-top-bar.orange { 
      background-color: #FF6600;  /* More vibrant orange */
      box-shadow: 0 0 15px rgba(255, 102, 0, 0.7),
                 0 0 30px rgba(255, 102, 0, 0.4),
                 0 0 45px rgba(255, 102, 0, 0.2),
                 0 0 60px rgba(255, 102, 0, 0.1),
                 inset 0 0 15px rgba(255, 255, 255, 0.3);  /* Reduced glow intensity */
    }
    .panel-top-bar.blue { 
      background-color: #0066CC;  /* Darker blue */
      box-shadow: 0 0 15px rgba(0, 102, 204, 0.7),
                 0 0 30px rgba(0, 102, 204, 0.4),
                 0 0 45px rgba(0, 102, 204, 0.2),
                 0 0 60px rgba(0, 102, 204, 0.1),
                 inset 0 0 15px rgba(255, 255, 255, 0.3);  /* Reduced glow intensity */
    }

    /* Hide the title and rarity in top bar */
    .champion-title, .champion-rarity {
      display: none;
    }

    /* MAIN CONTENT => flex:1 => two columns + buy button pinned at bottom */
    .panel-content {
      position: relative;
      flex: 1; /* fill leftover vertical space */
      display: flex;
      flex-direction: row;
      padding: 10px 20px;
      gap: 10px;  /* Reduce default gap from 20px to 10px */
      overflow: hidden; /* ensure content fits within panel */
    }

    /* LEFT COLUMN => champion card */
    .card-column {
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;  /* Change to flex-end for right alignment */
      flex: 0 0 50%; /* Increase from 40% to 50% */
      overflow: hidden;
      padding-right: 0;  /* Remove any padding */
    }
    .champion-card {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }

    /* RIGHT COLUMN => evolutions, stats, etc. */
    .info-column {
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      flex: 0 0 auto; /* Change from flex: 1 to flex: 0 0 auto */
      overflow: hidden;
      width: 220px; /* Set fixed width */
    }
    .evolutions-label {
      font-size: 14px;
      color: #aaa;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .evolutions-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      width: auto;  /* Change from fixed width to auto */
    }
    .evolution-item {
      background-color: #333;
      border-radius: 4px;
      padding: 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    .evolution-item.current {
      background-color: #ffff00;
      box-shadow: 0 0 15px rgba(255,255,0,0.3);
      transform: scale(1.05);
    }
    .evolution-item.current::after {
      content: '';
      position: absolute;
      inset: 0;
      border: 2px solid rgba(255,255,0,0.5);
      border-radius: 4px;
      pointer-events: none;
    }
    .evolution-item img {
      width: 53px;
      height: 53px;
      object-fit: contain;
    }
    .evolution-name {
      display: none; /* Hide the name label */
    }
    .stats-line {
      font-size: 14px;
      color: #fff;
      margin-bottom: 10px;
    }

    /* BUY BUTTON pinned at bottom right inside the panel */
    .buy-button {
      bottom: 0px;
      left: 0px;
      font-size: 14px;
      font-weight: bold;
      padding: 6px 12px;  /* Reduce padding */
      border-radius: 6px;
      border: none;
      cursor: pointer;
      white-space: nowrap;  /* Keep text on one line */
      width: fit-content;  /* Make button width fit content */
      min-width: min-content;  /* Ensure minimum width matches content */
    }
    .buy-button.green {
      background-color: #83ff71;
      color: #000;
    }
    .buy-button.green:hover {
      background-color: #70cc60;
    }
    .buy-button.purple {
      background-color: #a781ff;
      color: #000;
    }
    .buy-button.purple:hover {
      background-color: #9570e6;
    }

    /* DRAGGABLE COINS */
    .selector {
      position: absolute;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: grab;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0,0,0,0.5); /* semi-transparent black for better glow effect */
    }
    .selector::after {
      content: "";
      display: block;
      width: 30px;
      height: 30px;
      border: 3px solid currentColor;
      border-radius: 50%;
      box-shadow: 0 0 20px currentColor, inset 0 0 10px currentColor; /* stronger inner and outer glow */
    }
    .selector:active { cursor: grabbing; }

    .orange { 
      color: #ffff00; 
      top: 150px; 
      left: 150px; 
      box-shadow: 0 0 30px #ffff00, 0 0 50px #ffff00; /* double glow effect */
    }
    .blue { 
      color: #00ffff; 
      top: 250px; 
      left: 250px; 
      box-shadow: 0 0 30px #00ffff, 0 0 50px #00ffff; /* double glow effect */
    }

    /* STATS VISUALIZATION */
    .stats-circles {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      justify-content: flex-end;  /* Change to flex-end for right alignment */
      margin-bottom: 1px;
      width: 100%;
    }
    .stat-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      position: relative;
    }
    .stat-circle {
      width: 50px;
      height: 50px;
      position: relative;
    }
    .stat-value {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: bold;
      font-size: 16px;
      color: white;
      text-shadow: 
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
      z-index: 2;
    }
    .stat-label {
      font-size: 12px;
      color: #aaa;
      font-weight: bold;
    }
    .stat-atk circle.stat-fill { stroke: #ff4444; } /* Brighter red */
    .stat-hp circle.stat-fill { stroke: #44ff44; }  /* Brighter green */
    .stat-mana circle.stat-fill { stroke: #4444ff; } /* Brighter blue */

    /* Info badges */
    .info-badge {
      display: inline-block;
      background: #333;
      padding: 1px 12px;
      border-radius: 6px;
      margin-right: 3px;
      margin-bottom: 0px;
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* Add specific styling for orange panel */
    #orangePanel .panel-content {
      gap: 0;  /* Remove gap between columns in orange panel */
    }
    #orangePanel .info-column {
      align-items: flex-start;  /* Left align content in orange panel */
      padding-left: 10px;  /* Add left padding */
    }
    #orangePanel .evolutions-row {
      justify-content: flex-start;  /* Left align evolutions in orange panel */
      width: auto;  /* Change from 100% to auto */
    }
    #orangePanel .extraStats {
      text-align: left;  /* Left align the element/ability text */
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- TOP BAR -->
  <header>
    <div class="logo">CoOMidex</div>
  </header>

  <!-- SCROLLABLE GRID -->
  <div class="main-content">
    <div class="grid-container" id="gridContainer">
      <!-- We'll insert 151 champions here via JS -->
    </div>
  </div>

  <!-- BOTTOM DASH (two adjacent panels) -->
  <footer>
    <!-- ORANGE PANEL -->
    <div class="champion-panel" id="orangePanel">
      <div class="panel-top-bar orange">
        <div class="champion-title" id="orangeTitle">Champion ?</div>
        <div class="champion-rarity" id="orangeRarity">Rare</div>
      </div>
      <div class="panel-content">
        <!-- LEFT COLUMN => champion card -->
        <div class="card-column">
          <img class="champion-card" id="orangeCardImg" src="" alt="" style="display:none;">
        </div>
        <!-- RIGHT COLUMN => evolutions, stats, buy button -->
        <div class="info-column">
          <div class="evolutions-label">Evolutions</div>
          <div class="evolutions-row" id="orangeEvolutions"></div>
          <div class="stats-line" id="orangeStats">--</div>
          <button class="buy-button green" id="orangeBuyBtn" style="display:none;">Buy now</button>
        </div>
      </div>
    </div>

    <!-- BLUE PANEL -->
    <div class="champion-panel" id="bluePanel">
      <div class="panel-top-bar blue">
        <div class="champion-title" id="blueTitle">Champion ?</div>
        <div class="champion-rarity" id="blueRarity">Rare</div>
      </div>
      <div class="panel-content">
        <!-- LEFT COLUMN => champion card -->
        <div class="card-column">
          <img class="champion-card" id="blueCardImg" src="" alt="" style="display:none;">
        </div>
        <!-- RIGHT COLUMN => evolutions, stats, buy button -->
        <div class="info-column">
          <div class="evolutions-label">Evolutions</div>
          <div class="evolutions-row" id="blueEvolutions"></div>
          <div class="stats-line" id="blueStats"></div>
          <button class="buy-button purple" id="blueBuyBtn" style="display:none;">Buy now</button>
        </div>
      </div>
    </div>
  </footer>

  <!-- DRAGGABLE COINS -->
  <div id="selectorOrange" class="selector orange"></div>
  <div id="selectorBlue" class="selector blue"></div>

  <script>
    /*******************************************************
     * 1) CREATE THE GRID OF 151 CHAMPIONS
     *******************************************************/
    const gridContainer = document.getElementById('gridContainer');
    let activeCoin = document.getElementById('selectorOrange');  // Start with orange

    for (let i = 1; i <= 151; i++) {
      const div = document.createElement('div');
      div.classList.add('grid-item');
      div.dataset.championNumber = i;
      // "card pics/1.png" for big card, "small pics/1.png" for the small thumb
      div.dataset.cardImg = 'card pics/' + i + '.png';

      const img = document.createElement('img');
      img.src = 'small pics/' + i + '.png';
      img.alt = 'Champion ' + i;

      div.appendChild(img);
      gridContainer.appendChild(div);

      // Clicking => place the active coin on that square (snap)
      div.addEventListener('click', () => {
        placeCoinOnSquare(activeCoin, div);
        // Toggle active coin for next click
        activeCoin = (activeCoin === document.getElementById('selectorOrange')) 
          ? document.getElementById('selectorBlue')
          : document.getElementById('selectorOrange');
      });
    }

    /*******************************************************
     * 2) DRAGGABLE COINS (no snap-on-drop unless click)
     *******************************************************/
    let draggingCoin = null;  // coin currently being dragged
    let offsetX = 0, offsetY = 0;
    let currentHighlightedItem = null;
    let selectedItemOrange = null;
    let selectedItemBlue = null;

    const selectorOrange = document.getElementById('selectorOrange');
    const selectorBlue   = document.getElementById('selectorBlue');

    // MOUSE DOWN => start dragging if coin is clicked
    document.addEventListener('mousedown', e => {
      if (e.target === selectorOrange || e.target === selectorBlue) {
        draggingCoin = e.target;
        activeCoin = draggingCoin; // now this coin is "active"
        const rect = draggingCoin.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
      }
    });

    // MOUSE MOVE => if dragging, move coin + highlight champion
    document.addEventListener('mousemove', e => {
      if (draggingCoin) {
        draggingCoin.style.left = (e.clientX - offsetX) + 'px';
        draggingCoin.style.top  = (e.clientY - offsetY) + 'px';
        updateHighlight(draggingCoin);
      }
    });

    // MOUSE UP => drop coin => no snap
    document.addEventListener('mouseup', e => {
      if (draggingCoin) {
        // remove dashed highlight
        if (currentHighlightedItem) {
          currentHighlightedItem.classList.remove('highlight-orange', 'highlight-blue');
        }
        // check final drop => champion is selected, coin stays
        const rect = draggingCoin.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        draggingCoin.style.pointerEvents = 'none';
        let below = document.elementFromPoint(centerX, centerY);
        draggingCoin.style.pointerEvents = 'auto';

        if (below && below.closest('.grid-item')) {
          const gridItem = below.closest('.grid-item');
          selectChampion(draggingCoin, gridItem);
          // No "placeCoinOnSquare" => coin stays where dropped
        }
        draggingCoin = null;
        currentHighlightedItem = null;
      }
    });

    // highlight champion under coin center
    function updateHighlight(coin) {
      const rect = coin.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      coin.style.pointerEvents = 'none';
      let below = document.elementFromPoint(centerX, centerY);
      coin.style.pointerEvents = 'auto';

      // remove old highlight
      if (currentHighlightedItem) {
        currentHighlightedItem.classList.remove('highlight-orange', 'highlight-blue');
        currentHighlightedItem = null;
      }
      if (below && below.closest('.grid-item')) {
        currentHighlightedItem = below.closest('.grid-item');
        const highlightClass = (coin === selectorOrange) ? 'highlight-orange' : 'highlight-blue';
        currentHighlightedItem.classList.add(highlightClass);
      }
    }

    // place coin in center => only on click
    function placeCoinOnSquare(coin, gridItem) {
      const gridRect = gridItem.getBoundingClientRect();
      const coinRect = coin.getBoundingClientRect();
      const centerX = gridRect.left + (gridRect.width / 2) - (coinRect.width / 2);
      const centerY = gridRect.top + (gridRect.height / 2) - (coinRect.height / 2);
      coin.style.left = centerX + 'px';
      coin.style.top  = centerY + 'px';

      // Also select champion
      selectChampion(coin, gridItem);
    }

    // mark champion as selected => bottom panel updates
    function selectChampion(coin, gridItem) {
      const champNum = gridItem.dataset.championNumber;
      const cardImg  = gridItem.dataset.cardImg;
      if (coin === selectorOrange) {
        if (selectedItemOrange && selectedItemOrange !== gridItem) {
          selectedItemOrange.classList.remove('selected-orange');
        }
        selectedItemOrange = gridItem;
        gridItem.classList.add('selected-orange');
        updateChampionPanel('orange', champNum, cardImg);
      } else {
        if (selectedItemBlue && selectedItemBlue !== gridItem) {
          selectedItemBlue.classList.remove('selected-blue');
        }
        selectedItemBlue = gridItem;
        gridItem.classList.add('selected-blue');
        updateChampionPanel('blue', champNum, cardImg);
      }
    }

    /*******************************************************
     * 3) UPDATE BOTTOM PANELS
     *******************************************************/
    let championsData = [];  // Will store the loaded champion data

    // Load champions data when page loads
    fetch('./champions.json')
      .then(response => response.json())
      .then(data => {
        championsData = data;
        console.log('Data loaded, length:', data.length);
        // Force refresh any displayed champions
        if (selectedItemOrange) {
          const champNum = selectedItemOrange.dataset.championNumber;
          const cardImg = selectedItemOrange.dataset.cardImg;
          updateChampionPanel('orange', champNum, cardImg);
        }
        if (selectedItemBlue) {
          const champNum = selectedItemBlue.dataset.championNumber;
          const cardImg = selectedItemBlue.dataset.cardImg;
          updateChampionPanel('blue', champNum, cardImg);
        }
      })
      .catch(error => {
        console.error('Error loading champions data:', error);
      });

    function updateChampionPanel(coin, champNum, cardImg) {
      console.log('Updating panel for champion:', champNum);
      console.log('Champions data loaded:', championsData.length > 0);

      // Panel elements
      const titleEl  = document.getElementById(coin + 'Title');
      const rarityEl = document.getElementById(coin + 'Rarity');
      const imgEl    = document.getElementById(coin + 'CardImg');
      const evoEl    = document.getElementById(coin + 'Evolutions');
      const statsEl  = document.getElementById(coin + 'Stats');
      const buyBtnEl = document.getElementById(coin + 'BuyBtn');

      // Get champion data (array is 0-based, but champion numbers are 1-based)
      const champion = championsData[parseInt(champNum) - 1];
      console.log('Found champion data:', champion);

      if (!champion) {
        console.log('No data found for champion:', champNum);
        // Basic display if no data
        titleEl.textContent = 'Champion ' + champNum;
        
        // Create three distinct badges for unknown champion
        const rarity = document.createElement('span');
        rarity.className = 'info-badge';
        rarity.textContent = 'Unknown';

        const edition = document.createElement('span');
        edition.className = 'info-badge';
        edition.textContent = 'Edition: --';

        const gen = document.createElement('span');
        gen.className = 'info-badge';
        gen.textContent = 'Gen --';

        rarityEl.innerHTML = '';
        rarityEl.appendChild(rarity);
        rarityEl.appendChild(edition);
        rarityEl.appendChild(gen);

        imgEl.src = cardImg;
        imgEl.style.display = 'block';
        
        evoEl.innerHTML = '';
        const baseNum = Math.floor((parseInt(champNum) - 1) / 3) * 3 + 1;
        [baseNum, baseNum + 1, baseNum + 2].forEach(num => {
          const div = document.createElement('div');
          div.className = 'evolution-item';
          
          // Add small image (add 1 to match image numbers)
          const img = document.createElement('img');
          img.src = `small pics/${num + 1}.png`;  // Add +1 to match image numbers
          img.alt = `Champion ${num}`;
          div.appendChild(img);
          
          // Add name
          const name = document.createElement('div');
          name.className = 'evolution-name';
          name.textContent = `Champion ${num}`;
          div.appendChild(name);
          
          // Highlight current evolution
          if (num === parseInt(champNum)) {
            div.classList.add('current');
          }
          
          evoEl.appendChild(div);
        });
        
        statsEl.textContent = 'ATK: -- | HP: -- | MANA: -- | Element: -- | Ability: --';
        return;
      }

      console.log('Displaying champion:', champion.name);

      // Update with champion data
      titleEl.textContent = champion.name + (champion.title ? ` - ${champion.title}` : '');
      
      // Show rarity info in separate badges
      const rarity = document.createElement('span');
      rarity.className = 'info-badge';
      rarity.textContent = champion.rarity;

      const edition = document.createElement('span');
      edition.className = 'info-badge';
      edition.textContent = `${champion.edition} Edition`;

      const gen = document.createElement('span');
      gen.className = 'info-badge';
      gen.textContent = `Gen ${champion.generation}`;

      rarityEl.innerHTML = '';
      rarityEl.appendChild(rarity);
      rarityEl.appendChild(edition);
      rarityEl.appendChild(gen);

      if (champion.skin !== 'Classic') {
        const skin = document.createElement('span');
        skin.className = 'info-badge';
        skin.textContent = champion.skin;
        rarityEl.appendChild(skin);
      }

      if (champion.crafted) {
        const crafted = document.createElement('span');
        crafted.className = 'info-badge';
        crafted.textContent = `Crafted: ${champion.crafted}`;
        rarityEl.appendChild(crafted);
      }

      imgEl.src = cardImg;
      imgEl.style.display = 'block';

      // Split evolutions string and create evolution boxes
      evoEl.innerHTML = '';
      let evolutions = champion.evolutions.split(', ');
      let evoNumbers = [];
      
      // Find all champion numbers for the evolution chain
      for (let i = 0; i < championsData.length; i++) {
        if (evolutions.includes(championsData[i].name)) {
          evoNumbers.push(i + 1); // +1 because array is 0-based
        }
      }

      // Create container for evolutions with centered alignment if less than 3
      const evoContainer = document.createElement('div');
      evoContainer.style.display = 'flex';
      evoContainer.style.gap = '8px';
      evoContainer.style.justifyContent = evolutions.length < 3 ? 'center' : 'flex-start';
      
      // Create evolution boxes in the correct order
      evolutions.forEach((evo, index) => {
        const div = document.createElement('div');
        div.className = 'evolution-item';
        
        // Add small image using the found champion number
        const img = document.createElement('img');
        img.src = `small pics/${evoNumbers[index] || parseInt(champNum)}.png`;
        img.alt = evo;
        div.appendChild(img);
        
        // Add name
        const name = document.createElement('div');
        name.className = 'evolution-name';
        name.textContent = evo;
        div.appendChild(name);
        
        // Highlight current evolution
        if (champion.name === evo) {
          div.classList.add('current');
        }
        
        evoContainer.appendChild(div);
      });

      evoEl.appendChild(evoContainer);

      // Display all champion stats
      const statsContainer = document.createElement('div');
      statsContainer.className = 'stats-circles';
      
      // Create stat circles
      const stats = [
        { label: 'ATK', value: champion.attack || 0, maxValue: 10, class: 'stat-atk' },
        { label: 'HP', value: champion.health || 0, maxValue: 10, class: 'stat-hp' },
        { label: 'MANA', value: champion.manaCost || 0, maxValue: 10, class: 'stat-mana' }
      ];
      
      stats.forEach(stat => {
        const group = document.createElement('div');
        group.className = 'stat-group';
        
        const circle = document.createElement('div');
        circle.className = `stat-circle ${stat.class}`;
        
        // Create SVG for pie chart
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', '50');
        svg.setAttribute('height', '50');
        svg.setAttribute('viewBox', '0 0 50 50');
        
        // Background circle
        const bgCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        bgCircle.setAttribute('cx', '25');
        bgCircle.setAttribute('cy', '25');
        bgCircle.setAttribute('r', '22');
        bgCircle.setAttribute('fill', '#333');
        bgCircle.setAttribute('stroke-width', '3');
        
        // Foreground circle (pie slice)
        const fillCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        fillCircle.setAttribute('cx', '25');
        fillCircle.setAttribute('cy', '25');
        fillCircle.setAttribute('r', '22');
        fillCircle.setAttribute('fill', 'none');
        fillCircle.setAttribute('stroke-width', '3');
        fillCircle.classList.add('stat-fill');
        
        // Calculate percentage and stroke-dasharray
        const percentage = (stat.value / stat.maxValue);
        const circumference = 2 * Math.PI * 22;
        fillCircle.setAttribute('stroke-dasharray', `${circumference * percentage} ${circumference}`);
        fillCircle.setAttribute('transform', 'rotate(-90 25 25)');
        
        svg.appendChild(bgCircle);
        svg.appendChild(fillCircle);
        circle.appendChild(svg);
        
        // Add the value text
        const value = document.createElement('div');
        value.className = 'stat-value';
        value.textContent = stat.value;
        circle.appendChild(value);
        
        group.appendChild(circle);
        statsContainer.appendChild(group);
      });
      
      // Clear and update stats display
      statsEl.innerHTML = '';
      statsEl.appendChild(statsContainer);
      
      // Add element and ability text below circles
      const extraStats = document.createElement('div');
      extraStats.style.marginTop = '10px';
      extraStats.style.color = '#fff';
      extraStats.style.display = 'flex';
      extraStats.style.alignItems = 'center';
      extraStats.style.justifyContent = 'center';  // Changed to center for single items
      extraStats.style.width = '100%';  // Ensure full width

      if (champion) {
        let hasIcons = 0;  // Counter for number of icons

        // Element section
        if (champion.element && champion.element !== "----") {
          const elementSection = document.createElement('div');
          elementSection.style.display = 'flex';
          elementSection.style.alignItems = 'center';
          elementSection.style.justifyContent = 'center';
          
          const elementImg = document.createElement('img');
          elementImg.src = `elements/${champion.element.toLowerCase()}.png`;
          elementImg.alt = champion.element;
          elementImg.style.height = '40px';
          elementImg.style.width = '40px';
          elementImg.style.objectFit = 'contain';
          
          elementSection.appendChild(elementImg);
          extraStats.appendChild(elementSection);
          hasIcons++;
        }

        // Ability section
        if (champion.ability && champion.ability !== "----") {
          const abilitySection = document.createElement('div');
          abilitySection.style.display = 'flex';
          abilitySection.style.alignItems = 'center';
          abilitySection.style.justifyContent = 'center';

          const abilityImg = document.createElement('img');
          abilityImg.src = `abilities/${champion.ability.toLowerCase().replace(/\s+/g, '_')}.png`;
          abilityImg.alt = champion.ability;
          abilityImg.style.height = '40px';
          abilityImg.style.width = '40px';
          abilityImg.style.objectFit = 'contain';
          
          abilitySection.appendChild(abilityImg);
          extraStats.appendChild(abilitySection);
          hasIcons++;
        }

        // Adjust spacing based on number of icons
        if (hasIcons === 2) {
          extraStats.style.justifyContent = 'space-around';
          extraStats.style.gap = '0';
        } else {
          extraStats.style.justifyContent = 'center';
          extraStats.style.gap = '0';
        }
      } else {
        extraStats.innerHTML = '--';
      }
      statsEl.appendChild(extraStats);

      // Show the buy button
      buyBtnEl.className = '';  // Remove default classes
      buyBtnEl.style.display = 'flex';
      buyBtnEl.style.alignItems = 'center';
      buyBtnEl.style.justifyContent = 'center';  // Center the button
      buyBtnEl.style.gap = '0';
      buyBtnEl.style.cursor = 'pointer';
      buyBtnEl.style.transition = 'all 0.2s ease';
      buyBtnEl.style.border = 'none';
      buyBtnEl.style.outline = 'none';
      buyBtnEl.style.boxShadow = 'none';
      buyBtnEl.style.padding = '0';
      buyBtnEl.style.margin = '0 auto';  // Center horizontally
      buyBtnEl.style.backgroundColor = 'transparent';
      buyBtnEl.style.appearance = 'none';
      buyBtnEl.style.WebkitAppearance = 'none';
      buyBtnEl.style.MozAppearance = 'none';
      buyBtnEl.style.width = 'fit-content';  // Only as wide as content

      // Create container for pill shape
      const pillContainer = document.createElement('div');
      pillContainer.style.display = 'flex';
      pillContainer.style.backgroundColor = '#000';  // Black background
      pillContainer.style.borderRadius = '100px';  // Pill shape
      pillContainer.style.overflow = 'hidden';

      // Create price section (left side)
      const priceSection = document.createElement('div');
      priceSection.style.display = 'flex';
      priceSection.style.alignItems = 'center';
      priceSection.style.gap = '8px';
      priceSection.style.padding = '8px 12px';
      priceSection.style.backgroundColor = 'transparent';  // Changed to transparent
      priceSection.style.border = 'none';

      // Create HandCash logo
      const handcashLogo = document.createElement('img');
      handcashLogo.src = 'handcash.webp';  // Changed to webp
      handcashLogo.alt = 'HandCash';
      handcashLogo.style.height = '20px';
      handcashLogo.style.width = '20px';
      handcashLogo.style.objectFit = 'contain';

      // Create price text
      const priceText = document.createElement('span');
      priceText.style.color = '#fff';
      priceText.style.fontSize = '14px';
      priceText.style.fontWeight = 'bold';
      priceText.textContent = `$${(champion.price || 0).toFixed(2)}`;

      // Create buy now section (right side)
      const buyNowSection = document.createElement('div');
      buyNowSection.style.padding = '8px 12px';
      buyNowSection.style.backgroundColor = '#56ff97';  // New bright green color
      buyNowSection.style.color = '#000';
      buyNowSection.style.fontSize = '14px';
      buyNowSection.style.fontWeight = 'bold';
      buyNowSection.style.border = 'none';
      buyNowSection.textContent = 'BUY NOW';

      // Hover effects
      buyBtnEl.onmouseover = () => {
        priceSection.style.backgroundColor = 'transparent';
        buyNowSection.style.backgroundColor = '#47d680';  // Slightly darker on hover
      };
      buyBtnEl.onmouseout = () => {
        priceSection.style.backgroundColor = 'transparent';
        buyNowSection.style.backgroundColor = '#56ff97';  // Back to original color
      };

      buyBtnEl.onclick = () => {
        window.open(`https://handcash.io/pay/${champion.handcashHandle || 'unknown'}`, '_blank');
      };

      // Assemble the widget
      priceSection.appendChild(handcashLogo);
      priceSection.appendChild(priceText);

      pillContainer.appendChild(priceSection);
      pillContainer.appendChild(buyNowSection);

      buyBtnEl.innerHTML = '';
      buyBtnEl.appendChild(pillContainer);
    }
  </script>
</body>
</html>
